{% extends 'base.html' %}

{% block extrahead %}
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300&display=swap" rel="stylesheet">
<style>
    body {
        font-family: 'Roboto', sans-serif;
    }
</style>
{% endblock %}

{% block content %}
<div class="card mb-3">
    <img class="card-img-top" src="{{ contest.logo }}" alt="Card image cap">
    <div class="card-body">
        <h5 class="card-title">{{ contest.name }}</h5>
        <p class="card-text">{{ contest.description }}</p>
        <p class="card-text">Статус: {{ contest.get_status_display }}</p>
        <p class="card-text">Регистрация начинается: {{ contest.reg_start|date:"d.m.Y"  }}</p>
        <p class="card-text">Регистрация заканчивается: {{ contest.reg_end|date:"d.m.Y"  }}</p>
        <p class="card-text">Дата начала: {{ contest.date_start|date:"d.m.Y" }}</p>
        <p class="card-text">Дата окончания: {{ contest.date_end|date:"d.m.Y"  }}</p>
        <p class="card-text">Лимит участников: {{ contest.participant_cap }}</p>
        <p class="card-text">Минимальное количество команд: {{ contest.command_min }}</p>
        <p class="card-text">Максимальное количество команд: {{ contest.command_max }}</p>
        <p class="card-text">Регион: {{ contest.region }}</p>

        <p>Теги:</p>
        <div class="container">
            {% for tag in contest.tags.all %}
            <span class="badge badge-pill badge-secondary">{{ tag.name }}</span>
            {% endfor %}
        </div>

        <p>Участники:</p>
        <div class="container">
            {% for participant in contest.participants.all %}
            <span class="badge badge-pill badge-primary">{{ participant.username }}</span>
            {% endfor %}
        </div>

        {% if not participant %}
        <button type="button" id="submitBtn" class="btn btn-primary">Участвовать</button>
        {% endif %}
    </div>
</div>

<script>
$('#submitBtn').click(function(e) {
    e.preventDefault();
    var url = "{% url 'api:contest-set-participant' %}";
    $.ajax({
        headers: { "X-CSRFToken": '{{ csrf_token }}' },
        url: url,
        type: 'POST',
        data: {
            'contest_id': {{ contest.id }}
        },
        success: function(response) {
            location.reload();
        },
        error: function(error){
            console.log(error);
        }
    });
});
</script>

{% endblock content %}


